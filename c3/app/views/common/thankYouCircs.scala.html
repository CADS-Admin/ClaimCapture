@(lang: Lang)(implicit circs: models.domain.Claim, request: Request[AnyContent])
@import models.domain.CircumstancesDeclaration
@import controllers.mappings.Mappings


@import app.ConfigProperties._
@import models.domain.{CircumstancesBreaksInCare, CircumstancesEmploymentNotStarted, CircumstancesStartedAndFinishedEmployment, CircumstancesStartedEmploymentAndOngoing}
@import play.api.Play
@import play.api.Play.current
@import play.api.i18n.{MMessages => Messages, _}

@showBreaksInCareMessages = @{
    var breaksIncare = circs.questionGroup[CircumstancesBreaksInCare].getOrElse(CircumstancesBreaksInCare())
    breaksIncare.expectStartCaring.answer match {
        case Some(n) => n match {
            case mappings.Mappings.yes => if(!breaksIncare.expectStartCaring.expectStartCaringDate.isDefined) true else false
            case mappings.Mappings.dontknow => true
            case _ => false
        }
        case _ => false
    }
}

@showEmployment1Messages = @{
    circs.questionGroup[CircumstancesStartedEmploymentAndOngoing].isDefined
}

@showEmployment2Messages = @{
    circs.questionGroup[CircumstancesStartedAndFinishedEmployment].isDefined
}

@showEmploymentPensionMessage = @{
    lazy val ongoingEmploymentOption = circs.questionGroup[CircumstancesStartedEmploymentAndOngoing]
    lazy val finishedEmploymentOption = circs.questionGroup[CircumstancesStartedAndFinishedEmployment]
    lazy val futureEmploymentOption = circs.questionGroup[CircumstancesEmploymentNotStarted]

    val show =
        if(ongoingEmploymentOption.isDefined)
            ongoingEmploymentOption.get.payIntoPension.answer == "yes"
        else if(finishedEmploymentOption.isDefined)
            finishedEmploymentOption.get.payIntoPension.answer == "yes"
        else if(futureEmploymentOption.isDefined)
                futureEmploymentOption.get.payIntoPension.answer == "yes"
            else false

    show
}

@isEmail = @{
    getProperty("email.frontend",false) && circs.questionGroup[CircumstancesDeclaration].getOrElse(CircumstancesDeclaration()).wantsContactEmail.getOrElse("") == Mappings.yes
}

@defining(lang) { implicit language =>
    @common.govMain(Messages("circs.thankyou")) {

        <div class="carers-allowance clearfix" data-journey="carers-allowance:report-change:thank-you">

            @common.protoType()

            <article class="finish-statement">

                <section class="app-complete">
                    <h1>@Html(Messages("circs.thankyou"))</h1>
                </section>

                <div class="finish-mobile">@Html(Messages("circs.feedback.link"))</div>

                <div class="finish-info">

                    <section>
                        <h2>@Html(Messages("next"))</h2>
                        @if(isEmail){
                            <p>@Html(Messages("email.circs.thankYou"))</p>
                        }
                        <p>@Html(Messages("circs.next.1"))</p>
                    </section>

                    <div class="send-info">

                        <h2>@Html(Messages("required.docs"))</h2>

                        <p>@Html(Messages("thankyou.send"))</p>

                        <section>
                            <ul>
                                @if(showBreaksInCareMessages) {
                                    <li>@Html(Messages("circs.thankyou.breakmessage.content"))</li>
                                }

                                @if(showEmployment1Messages) {
                                    <li>@Html(Messages("circs.thankyou.employment1message2.content"))</li>
                                    @if(showEmploymentPensionMessage) {
                                        <li>@Html(Messages("circs.thankyou.employment1message3.content"))</li>
                                    }
                                }

                                @if(showEmployment2Messages) {
                                    <li>@Html(Messages("circs.thankyou.employment2message2.content"))</li>
                                    <li>@Html(Messages("circs.thankyou.employment2message3.content"))</li>
                                    @if(showEmploymentPensionMessage) {
                                        <li>@Html(Messages("circs.thankyou.employment2message4.content"))</li>
                                    }
                                }
                            </ul>
                        </section>

                        <section class="address">
                            <p>@Html(Messages("address.send"))</p>
                            <span><b>@Html(Messages("address.title"))</b></span>
                            <span>@Html(Messages("s11.g5.help11"))</span>
                            <span>@Html(Messages("s11.g5.help12"))</span>
                            <span>@Html(Messages("s11.g5.help13"))</span>
                            <span>@Html(Messages("s11.g5.help14"))</span>
                            <p>@Html(Messages("address.details"))</p>

                    </div>

                </div>

                <p><a href="@Html(Messages("thankyou.report.change.url"))">@Html(Messages("thankyou.report.another.change"))</a></p>

                <div class="finish-button">@Html(Messages("claim.feedback.link"))</div>

            </article>

            <aside class="left-col right-panel" aria-labelledby="helpcontent">
                <section id="help">
                    <h2>@Html(Messages("leftcol.title"))</h2>
                    <h3>@Html(Messages("leftcol.helpline"))</h3>
                    <p>@Html(Messages("leftcol.helplinecontent.1"))</p>
                    <p class="grouped">@Html(Messages("leftcol.helplinecontent.2"))</p>
                    <p>@Html(Messages("leftcol.helplinecontent.3"))</p>
                    <p>@Html(Messages("leftcol.helplinecontent.4")) <a href="https://www.gov.uk/call-charges" target="_blank" @views.html.ga.trackClickEvent(linkName = "Call charges")>@Messages("leftcol.callcharges")</a></p>
                </section>
            </aside>


            @if(getProperty("display.transid", false)) {
                <input type="hidden" name="transId" id="transId" value="@{
                    circs.transactionId.getOrElse("NO_TRANS_ID")
                }"/>
            }
        </div>
    }
}
<script type="text/javascript">
$ ( function ( ) {
    @if(!Play.isTest) {
        trackEvent ("times", "circs - end");
        var start = getCookie("circsstarts");
        var now = new Date( ).getTime();
        var durationFromStart = now - start;
        trackTiming('TimeToCompletion','circs from start', durationFromStart);
    @ga.stagePrompt()
}} )
</script>
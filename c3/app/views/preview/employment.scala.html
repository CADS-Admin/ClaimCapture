@()(implicit claim: models.domain.Claim, request: Request[AnyContent], lang: Lang, messages: play.api.i18n.Messages)
@import models.domain._
@import scala.language.postfixOps
@import helper._
@import controllers.mappings.Mappings._
@import views.html.preview.jobsPreview

@claimDate = @{claim.questionGroup[ClaimDate].getOrElse(ClaimDate())}
@emp = @{claim.questionGroup[YourIncomes].getOrElse(YourIncomes())}
@aboutSelfEmployment = @{claim.questionGroup[AboutSelfEmployment].getOrElse(AboutSelfEmployment())}
@additionalInfo = @{claim.questionGroup[EmploymentAdditionalInfo].getOrElse(EmploymentAdditionalInfo())}
@sixMonthsBeforeDate(date:DayMonthYear) = @{date - 6 months}
@oneWeekBeforeDate(date:DayMonthYear) = @{date - 1 weeks}

@selfEmploymentItems(claim:Claim) = @{
    val pension = claim.questionGroup[SelfEmploymentPensionsAndExpenses].getOrElse(SelfEmploymentPensionsAndExpenses())
    var elems = Seq.empty[String]
    if(pension.haveExpensesForJob.answer == "yes" || pension.payPensionScheme.answer == "yes")
        elems = elems ++ Seq(messages("expenses"))

    elems
}
@selfEmploymentSummary(claim:Claim) = @{
    var text = messages("detailsProvided.simple")
    val items = selfEmploymentItems(claim)

    if(items.size > 0){
        text = text +" "+messages("including")+" "+items(0)
    }
    text
}
@isSelfEmployed = @{emp.beenSelfEmployedSince1WeekBeforeClaim == yes}
@isEmployed = @{emp.beenEmployedSince6MonthsBeforeClaim == yes}
@seValue = @{
	if(isSelfEmployed){
		messages("label.yes") + " - " + selfEmploymentSummary(claim)
	} else {
		messages("label.no")
	}
}

@additionalInfoValue = @{
	additionalInfo.empAdditionalInfo.answer match {
		case `yes` => messages("label.yes") + " - " + messages("detailsProvided.simple")
		case _ => messages("label.no")
	}
}
@disableChangeButton = @{
	!app.ConfigProperties.getProperty("cyaToggleVisible",true)
}

@content = {
	@fieldWithLink("employment_been_employed_since", messages("beenEmployed.simple",sixMonthsBeforeDate(claimDate.dateOfClaim).`d month yyyy`),messages("label."+emp.beenEmployedSince6MonthsBeforeClaim),disableLink = disableChangeButton, elementId = Some("beenEmployedSince6MonthsBeforeClaim"))
	@{/* Jobs do not use the fieldWithLink view. The fieldWithLink view accepts text and this produces HTML (an unordered list) */}
	@jobsPreview()
    @fieldWithLink("self_employment_been_self_employed", messages("beenSelfEmployed.simple",oneWeekBeforeDate(claimDate.dateOfClaim).`d month yyyy`), seValue,disableLink = disableChangeButton, elementId = Some("beenSelfEmployedSince1WeekBeforeClaim"))
    @if(emp.beenSelfEmployedSince1WeekBeforeClaim == "yes"){
		@fieldWithLink("self_employment_nature_of_business", messages("natureOfYourBusiness"), aboutSelfEmployment.natureOfYourBusiness, disableLink = disableChangeButton, elementId = Some("natureOfYourBusiness"))
	}
	@if(isSelfEmployed || isEmployed){
		@fieldWithLink("employment_additional_info", messages("empAdditionalInfo.text"), additionalInfoValue, disableLink = disableChangeButton, elementId = Some("empAdditionalInfo_answer"))
	}
}

@accordion(label = messages("employment.title"), openLabel = "open-employments", closeLabel = "close-employments", content = content, 'track -> true)


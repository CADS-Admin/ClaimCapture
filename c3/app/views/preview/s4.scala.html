@()(implicit claim: models.domain.Claim, request: Request[AnyContent], lang: Lang)
@import models.domain.YourPartnerPersonalDetails
@import models.domain.BreaksInCare
@import models.domain.MoreAboutTheCare
@import models.domain.TheirContactDetails

@import models.domain.TheirPersonalDetails
@import play.api.i18n.{MMessages => Messages}
@import helper._

@livesSameAddress = @{claim.questionGroup[TheirPersonalDetails].exists(_.liveAtSameAddressCareYouProvide == mappings.Mappings.yes)}
@yourPartner = @{claim.questionGroup[YourPartnerPersonalDetails].getOrElse(YourPartnerPersonalDetails())}
@abouTheCare = @{claim.questionGroup[MoreAboutTheCare].getOrElse(MoreAboutTheCare())}
@theirPersonalDetails = @{claim.questionGroup[TheirPersonalDetails].getOrElse(TheirPersonalDetails())}
@theirContactDetails = @{claim.questionGroup[TheirContactDetails].getOrElse(TheirContactDetails())}
@address = @{theirContactDetails.address}
@breaks = @{claim.questionGroup[BreaksInCare].getOrElse(BreaksInCare())}
@ninoNumber(ni:NationalInsuranceNumber) = @{
    ni.stringify
}

@showHidePartnerDetails = @{
    yourPartner.hadPartnerSinceClaimDate == "no" ||
            (yourPartner.isPartnerPersonYouCareFor.isDefined &&
                    yourPartner.isPartnerPersonYouCareFor.get.toLowerCase == "no")
}

@partnerTitleName = @{
    if (showHidePartnerDetails){
        val title = Html(Messages("titleSelect."+theirPersonalDetails.title.toLowerCase))
        s"$title ${theirPersonalDetails.firstName} ${theirPersonalDetails.middleName.map(_+" ").getOrElse("")}${theirPersonalDetails.surname}"
    } else {
        ""
    }
}

@addressLine = @{
    s"${address.lineOne.getOrElse("")}${address.lineTwo.fold("")(", "+_)}${address.lineThree.fold("")(", "+_)} ${theirContactDetails.postcode.getOrElse("")}"
}

@breaksAnswer = @{
    Html(Messages("label."+(if (breaks.breaks.length > 0) "yes" else "no"))) + (if (breaks.breaks.length > 0) Messages("breaks.details",breaks.breaks.length) else "")
}

<h2 class="heading-medium accordion-title">@Html(Messages("careYouProvide"))</h2>

<div class="accordion-content open">
	<table class="review">
		@if(showHidePartnerDetails){
		    @fieldWithLink("care_you_provide_name", "name", partnerTitleName)
		    @if(theirPersonalDetails.nationalInsuranceNumber.isDefined){
		        @defining(theirPersonalDetails.nationalInsuranceNumber.get){ nino =>
		            @fieldWithLink("care_you_provide_nino", "nationalInsuranceNumber", ninoNumber(nino))
		        }
		    }
		    @fieldWithLink("care_you_provide_dob", "dateOfBirth", theirPersonalDetails.dateOfBirth.`dd month, yyyy`)
		}
		@fieldWithLink("care_you_provide_address", "address", addressLine, disableLink = livesSameAddress)
		@fieldWithLink("care_you_provide_relationship", "relationship", theirPersonalDetails.relationship)
		@fieldWithLink("care_you_provide_spent35HoursCaring", "spent35HoursCaring", s"${Html(Messages("label."+abouTheCare.spent35HoursCaring))}")
		@fieldWithLink("care_you_provide_anyBreaks", "anyBreaks", Html(Messages("label."+(if (breaks.breaks.length > 0) "yes" else "no"))) + (if (breaks.breaks.length > 0) Messages("breaks.details",breaks.breaks.length) else ""))
	</table>
</div>
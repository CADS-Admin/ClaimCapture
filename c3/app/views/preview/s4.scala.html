@()(implicit claim: models.domain.Claim, request: Request[AnyContent], lang: Lang)
@import models.domain.YourPartnerPersonalDetails
@import models.domain.BreaksInCare
@import models.domain.MoreAboutTheCare
@import controllers.mappings.Mappings._
@import models.domain.TheirPersonalDetails
@import play.api.i18n.{MMessages => Messages}
@import helper._

@yourPartner = @{claim.questionGroup[YourPartnerPersonalDetails].getOrElse(YourPartnerPersonalDetails())}
@abouTheCare = @{claim.questionGroup[MoreAboutTheCare].getOrElse(MoreAboutTheCare())}
@theirPersonalDetails = @{claim.questionGroup[TheirPersonalDetails].getOrElse(TheirPersonalDetails())}
@address = @{
	theirPersonalDetails.theirAddress.answer match {
		case `yes` => Messages("label.yes")
		case _ => Messages("label.no") + " - " + getAddressLine(theirPersonalDetails.theirAddress.address.getOrElse(MultiLineAddress()))
	}
}

@showHidePartnerDetails = @{
    yourPartner.hadPartnerSinceClaimDate == "no" ||
            (yourPartner.isPartnerPersonYouCareFor.isDefined &&
                    yourPartner.isPartnerPersonYouCareFor.get.toLowerCase == "no")
}

@partnerTitleName = @{
    if (showHidePartnerDetails){
        val title = Html(Messages("titleSelect."+theirPersonalDetails.title.toLowerCase))
        s"$title ${theirPersonalDetails.firstName} ${theirPersonalDetails.middleName.map(_+" ").getOrElse("")}${theirPersonalDetails.surname}"
    } else {
        ""
    }
}

@getAddressLine(address: MultiLineAddress) = @{
    s"${address.lineOne.getOrElse("")}${address.lineTwo.fold("")(", "+_)}${address.lineThree.fold("")(", "+_)} ${theirPersonalDetails.theirAddress.postCode.getOrElse("")}"
}
@disableChangeButton = @{
	!app.ConfigProperties.getProperty("cyaToggleVisible",true)
}

<div class="accordion accordion-open">

	<h2 class="heading-medium accordion-title">@Html(Messages("s4.longName"))</h2>
	
	<div class="accordion-content">
		<table class="review">
			@if(showHidePartnerDetails){
			    @fieldWithLink("care_you_provide_name", "name", partnerTitleName,disableLink = disableChangeButton, elementId = Some("firstName"))
				@{/** dateOfBirth anchors to national insurance number because javascript causes conflict with page height **/}
			    @fieldWithLink("care_you_provide_dob", "dateOfBirth", theirPersonalDetails.dateOfBirth.`dd month, yyyy`,disableLink = disableChangeButton, elementId = Some("nationalInsuranceNumber_nino"))
			}
			@fieldWithLink("care_you_provide_relationship", "relationship", theirPersonalDetails.relationship,disableLink = disableChangeButton, elementId = Some("relationship"))
			@fieldWithLink("care_you_provide_address", "theirAddress.answer", address,disableLink = disableChangeButton, elementId = Some("theirAddress_answer"))
			@fieldWithLink("care_you_provide_spent35HoursCaring", "spent35HoursCaring", s"${Html(Messages("label."+abouTheCare.spent35HoursCaring))}",disableLink = disableChangeButton, elementId = Some("spent35HoursCaring"))
		</table>
	</div>

</div>
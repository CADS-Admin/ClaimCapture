@()(implicit claim: models.domain.Claim, request: Request[AnyContent], lang: Lang)

@import models.domain._
@import play.api.i18n.{MMessages => Messages}
@import app.MaritalStatus._

@yourDetails = @{claim.questionGroup[YourDetails].getOrElse(YourDetails())}
    @nino = @{
        val ni = yourDetails.nationalInsuranceNumber
        if (ni.ni1.isDefined) s"${ni.ni1.get.toUpperCase} ${ni.ni2.get} ${ni.ni3.get} ${ni.ni4.get} ${ni.ni5.get.toUpperCase}"
        else ""
    }
@contactDetails = @{claim.questionGroup[ContactDetails].getOrElse(ContactDetails())}
@address = @{contactDetails.address}
@claimDate = @{claim.questionGroup[ClaimDate].getOrElse(ClaimDate())}
@nationalityAndResidency = @{
    claim.questionGroup[NationalityAndResidency].getOrElse(NationalityAndResidency(""))
}
@nationality = @{
    nationalityAndResidency.actualnationality match {
        case Some(n) => n
        case _ => nationalityAndResidency.nationality
    }
}
@otherEEA = @{claim.questionGroup[OtherEEAStateOrSwitzerland].getOrElse(OtherEEAStateOrSwitzerland())}
@trips = @{claim.questionGroup[Trips].getOrElse(Trips())}
@maritalStatus = @{
nationalityAndResidency.maritalStatus match {
        case Some(Married) => Messages("maritalStatus.married")
        case Some(Single) => Messages("maritalStatus.single")
        case Some(Divorced) => Messages("maritalStatus.divorced")
        case Some(Widowed) => Messages("maritalStatus.widowed")
        case Some(Separated) => Messages("maritalStatus.separated")
        case Some(Partner) => Messages("maritalStatus.livingWithPartner")
        case _ => ""
    }
}
@middleName = @{yourDetails.middleName.map(_+" ").getOrElse("")}
@titleNames = @{
    s"${Html(Messages("titleSelect."+yourDetails.title.toLowerCase))} ${yourDetails.firstName} ${middleName}${yourDetails.surname}"
}

@addressPostcode = @{
    s"${address.lineOne.getOrElse("")}${address.lineTwo.fold("")(", "+_)}${address.lineThree.fold("")(", "+_)} ${contactDetails.postcode.getOrElse("")}"
}

@g1YourDetailsRoute = @{
    controllers.s2_about_you.routes.G1YourDetails.present.toString
}

@g2ContactDetailsRoute = @{
    controllers.s2_about_you.routes.G2ContactDetails.present.toString
}

@g4NationalityRoute = @{
    controllers.s2_about_you.routes.G4NationalityAndResidency.present.toString
}

@g7OtherEEARoute = @{
    controllers.s2_about_you.routes.G7OtherEEAStateOrSwitzerland.present.toString
}

@routesMap = @{
    Map("about_you_full_name" -> g1YourDetailsRoute,
        "about_you_nino" -> g1YourDetailsRoute,
        "about_you_dob" -> g1YourDetailsRoute,
        "about_you_address" -> g2ContactDetailsRoute,
        "about_you_contact" -> g2ContactDetailsRoute,
        "about_you_marital_status" -> g4NationalityRoute,
        "about_you_claimDate" -> controllers.s1_2_claim_date.routes.G1ClaimDate.present.toString,
        "about_you_nationality" -> g4NationalityRoute,
        "about_you_abroad" -> controllers.s2_about_you.routes.G5AbroadForMoreThan52Weeks.present.toString,
        "about_you_benefitsFromEEA" -> g7OtherEEARoute,
        "about_you_workingForEEA" -> g7OtherEEARoute)
}

@fieldWithLink(id:String, name:String, value:String) = @{
    val label = Html(Messages(name))
    val row = s"<dt><a id=$id href=${routesMap(id)}>$label</a></dt><dd>$value</dd>"
    Html(row)
}

<h2>@Html(Messages("aboutYou.title"))</h2>
<dl>
    @fieldWithLink("about_you_full_name", "name", titleNames)
    @fieldWithLink("about_you_nino", "nationalInsuranceNumber", nino)
    @fieldWithLink("about_you_dob", "dateOfBirth", yourDetails.dateOfBirth.`dd month, yyyy`)
    @fieldWithLink("about_you_address", "address", addressPostcode)
    @fieldWithLink("about_you_contact", "howWeContactYou", contactDetails.howWeContactYou)
    @if(nationalityAndResidency.maritalStatus.isDefined){
        @fieldWithLink("about_you_marital_status", "maritalStatusNQ", maritalStatus)
    }
    @fieldWithLink("about_you_claimDate", "dateOfClaim.simple", claimDate.dateOfClaim.`dd month, yyyy`)
    @fieldWithLink("about_you_nationality", "yourNationality", nationality)
    @fieldWithLink("about_you_abroad", "timeOutsideGB", Messages("label."+(if (trips.fiftyTwoWeeksTrips.size > 0) "yes" else "no")))
    @fieldWithLink("about_you_benefitsFromEEA", "benefitsFromEEA", Messages("label."+otherEEA.benefitsFromEEA))
    @fieldWithLink("about_you_workingForEEA", "workingForEEA", Messages("label."+otherEEA.workingForEEA))
</dl>
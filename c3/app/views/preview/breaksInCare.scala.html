@()(implicit claim: models.domain.Claim, request: Request[AnyContent], lang: Lang, messages: play.api.i18n.Messages)
@import models.domain.BreaksInCare
@import models.domain.Breaks
@import models.domain.ClaimDate
@import helper._
@import app.ConfigProperties._
@import models.domain.TheirPersonalDetails

@breaks = @{claim.questionGroup[BreaksInCare].getOrElse(BreaksInCare())}
@breaksFromDate = @{claim.questionGroup[ClaimDate].getOrElse(ClaimDate()).dateWeRequireBreakInCareInformationFrom(lang)}
@theirPersonalDetails = @{claim.questionGroup[TheirPersonalDetails].getOrElse(TheirPersonalDetails())}
@dpname=@{theirPersonalDetails.firstName+" "+theirPersonalDetails.surname}
@disableChangeButton = @{!getBooleanProperty("cyaToggleVisible")}

@hasBreaksMessage(breakType: String = "MatchAny") = @{
	val found = breakType match {
		case "MatchAny" => breaks.hasBreaks
		case _ => breaks.hasBreaksForType(breakType)
	}

	(breakType, found) match {
		case ("MatchAny", true) => messages("label.yes")
		case (_, true) => messages("yesDetailsProvided")
		case (_, false) => messages("label.no")
	}
}

@content = {
	@fieldWithLink("breaks_breaktype", messages("breaktype_first",breaksFromDate, dpname), hasBreaksMessage(), disableLink = disableChangeButton)
	@if(breaks.hasBreaksForType(Breaks.hospital)) {
		@fieldWithLink("breaks_breaktype", "breaks.hospital", hasBreaksMessage(Breaks.hospital), disableLink = disableChangeButton)
	}
	@if(breaks.hasBreaksForType(Breaks.carehome)) {
		@fieldWithLink("breaks_breaktype", "breaks.carehome", hasBreaksMessage(Breaks.carehome), disableLink = disableChangeButton)
	}
	@fieldWithLink("breaks_breaktype", messages("breaktype_other_first", dpname), hasBreaksMessage(Breaks.another), disableLink = disableChangeButton)
}

@accordion(label = messages("s4.5.longName"), openLabel = "open-breaks-in-care", closeLabel = "close-breaks-in-care", content = content, 'track -> true)

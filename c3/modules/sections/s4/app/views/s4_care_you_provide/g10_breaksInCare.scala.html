@(yesNoForm: Form[models.yesNo.YesNo], breaksInCare: models.domain.BreaksInCare)(implicit claim: models.domain.Claim, request: play.api.mvc.Request[_])

@import views.html.helper._
@import models.domain.{BreaksInCare, Claim, ClaimDate, MoreAboutTheCare}
@import utils.helpers.CarersCrypto

@dateOfClaimCheckIfSpent35HoursCaringBeforeClaim() = @{
    import language.postfixOps

    val spent35HoursCaringBeforeClaim = claim.questionGroup(MoreAboutTheCare) match {
        case Some(m: MoreAboutTheCare) => m.spent35HoursCaringBeforeClaim.answer == "yes"
        case _ => false
    }

    claim.dateOfClaim.fold("{NO CLAIM DATE}")(dmy =>
        if (spent35HoursCaringBeforeClaim) (dmy - 6 months).`dd/MM/yyyy`
        else dmy.`dd/MM/yyyy`)
}

@main(Messages("s4.g5") + " - " + Messages("s4.longName"), Some(yesNoForm), claim.completedQuestionGroups(BreaksInCare)) {
    <fieldset id="breaks" class="form-elements results-detail">
        <legend>Breaks already added</legend>

        <table>
            <caption>Break details</caption>

            <thead>
                <tr>
                    <th>Break period</th>
                    <th class="desc">@Messages("breaks.whereYou.label")</th>
                    <th class="desc">@Messages("wherePerson")</th>
                    <th class="desc">Medical treatment</th>
                    <th>Change</th>
                    <th>Delete</th>
                </tr>
            </thead>

            <tbody>
                @for(break <- breaksInCare.breaks) {
                    <tr id="@break.id" class="@break.id">
                        <td>
                            @{break.start.`dd/MM/yyyy`}
                            @if(break.end.isDefined){<span>to</span>}
                            @{break.end.fold("")(_.`dd/MM/yyyy`)}
                        </td>

                        <td class="desc">@break.whereYou.location</td>
                        <td class="desc">@break.wherePerson.location</td>
                        <td class="desc">@if("yes" == break.medicalDuringBreak) { Yes } else { No }</td>
                        <td><input type="button" class="button row secondary" value="Change"></td>
                        <td><input type="button" class="button row warning" value="Delete"></td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="prompt breaks-prompt">
            <p>Are you sure you want to delete this break?</p>
            <input type="button" class="button row secondary" value="No">
            <input type="button" class="button row warning" value="Yes">
            <span>&#33;</span>
        </div>
    </fieldset>
    
    <p class="mandatory">Fields marked with <em>*</em> are mandatory</p>

    @form(action = controllers.s4_care_you_provide.routes.G10BreaksInCare.submit) {
        <fieldset class="form-elements">
            <legend>@Messages("s4.g5")</legend>

            <ul class="group">
                @defining(if(breaksInCare.breaks == Nil || breaksInCare.breaks.isEmpty) {"answer.label"} else {"answer.more.label"}) { answerLabel =>
                    @yesNoRadioGroup(yesNoForm("answer"), '_label -> Messages(answerLabel, dateOfClaimCheckIfSpent35HoursCaringBeforeClaim))
                }
            </ul>

            <div id="warningMessageWrap" class="prompt breaks-prompt breaks-error-prompt" style="display: none;">
                <p>We will contact you about more breaks in care.</p>
                <span>!</span>
            </div>

            <div class="prompt helper-prompt">
                <p>Enter all breaks you've had. Some of them might not affect your entitlement.</p>

                <p class="intro">
                    By break we mean time when, for any reason, you spent less than 35 hours a week caring for the person you care for. For example, if:
                </p>

                <ul>
                    <li>They were in respite care, in hospital or on holiday without you, or</li>
                    <li>You were in hospital or on holiday without them..</li>
                </ul>
            </div>

        </fieldset>

        <nav class="form-steps">
            <a id="backButton" href="@claim.navigation.previous" class="button secondary">Back</a>
            <button type="submit" name="action" value="next" class="button">Next</button>
        </nav>
    }
}

<script type="text/javascript" src='@routes.Assets.at("javascripts/s4_care_you_provide/g10_breaksInCare.js")'></script>

<script type="text/javascript">
    $(function () {
        window.initEvents("@CarersCrypto.encryptAES("answer_yes")", "@CarersCrypto.encryptAES("answer_no")");
    });
</script>